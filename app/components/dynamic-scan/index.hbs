<AkStack @direction='column' @alignItems='center' @spacing='1'>
  {{#if @file.isDynamicStatusNotReady}}
    <AkStack @alignItems='stretch' @spacing='1.5'>
      {{#if @file.isDynamicStatusNeitherNoneNorReadyNorError}}
        <AkChip
          data-test-dynamicScan-startBtn
          @label={{@file.statusText}}
          @variant='semi-filled'
          @color={{this.color}}
        >
          <:icon>
            <AkLoader @color={{this.color}} @size={{13}} />
          </:icon>
        </AkChip>

        {{#if @file.isDynamicStatusQueueAndHasAutomation}}
          <AkIconButton
            data-test-dynamicScan-restartBtn
            {{style padding='0.5em'}}
            {{on 'click' this.openDynamicScanModal}}
            @variant='outlined'
            @borderColor='primary'
            disabled={{not @file.isActive}}
          >
            <AkIcon @iconName='refresh' @color='primary' />
          </AkIconButton>
        {{/if}}
      {{/if}}

      {{#if @file.isDynamicStatusNoneOrError}}
        {{#if @file.isDynamicStatusError}}
          <AkChip
            data-test-dynamicScan-startBtn
            @variant='semi-filled'
            @label={{t 'errored'}}
            @color='warn'
          >
            <:icon>
              <AkIcon @iconName='warning' />
            </:icon>
          </AkChip>

          <AkIconButton
            data-test-dynamicScan-restartBtn
            data-test-cy='dynamicScan-restartBtn'
            {{style padding='0.5em'}}
            {{on 'click' this.openDynamicScanModal}}
            @variant='outlined'
            @borderColor='primary'
            disabled={{not @file.isActive}}
          >
            <AkIcon @iconName='refresh' @color='primary' />
          </AkIconButton>

        {{else if @file.isDynamicDone}}
          <AkButton
            data-test-dynamicScan-restartBtn
            data-test-cy='dynamicScan-restartBtn'
            {{style padding='0.5em'}}
            {{on 'click' this.openDynamicScanModal}}
            disabled={{not @file.isActive}}
          >
            <:leftIcon>
              <AkIcon @iconName='refresh' />
            </:leftIcon>

            <:default>{{@dynamicScanText}}</:default>
          </AkButton>
        {{else}}
          <AkButton
            data-test-dynamicScan-startBtn
            {{on 'click' this.openDynamicScanModal}}
          >
            <:leftIcon>
              <AkIcon @iconName='play-arrow' />
            </:leftIcon>

            <:default>{{@dynamicScanText}}</:default>
          </AkButton>
        {{/if}}
      {{/if}}
    </AkStack>
  {{/if}}

  {{#if @file.isDynamicStatusReady}}
    <AkButton
      data-test-dynamicScan-stopBtn
      {{on 'click' (perform this.dynamicShutdown)}}
      @disabled={{not @file.isActive}}
    >
      <:leftIcon>
        {{#if this.dynamicShutdown.isRunning}}
          <AkLoader @size={{13}} />
        {{else}}
          <AkIcon @iconName='stop' />
        {{/if}}
      </:leftIcon>

      <:default>{{t 'stop'}}</:default>
    </AkButton>
  {{/if}}
</AkStack>

{{!-- {{#if this.showDynamicScanModal}} --}}
<ProjectPreferences::Provider
  @profileId={{this.profileId}}
  @platform={{this.projectPlatform}}
  @project={{@file.project.content}}
  as |dpContext|
>
  <DynamicScan::Modal
    @onClose={{this.closeDynamicScanModal}}
    @pollDynamicStatus={{this.pollDynamicStatus}}
    @file={{@file}}
    @dpContext={{dpContext}}
    @isAutomatedScan={{@isAutomatedScan}}
  />
</ProjectPreferences::Provider>
{{!-- {{/if}} --}}