<AkStack
  local-class='vulnerability-header'
  @alignItems='center'
  @justifyContent='space-between'
>
  <AkStack @direction='column' @spacing='0.5'>
    <AkTypography data-test-vulnerability-analysis-title @variant='h5'>
      {{t 'vulnerabilityDetails'}}
    </AkTypography>

    <AkTypography
      data-test-vulnerability-analysis-description
      @variant='body2'
      @color='textSecondary'
    >
      {{t 'fileVulnerabilityDetailsDescription'}}
    </AkTypography>
  </AkStack>

  <AkStack @spacing='1.5'>
    {{#if this.isSecurityEnabled}}
      <AkButton
        @tag='a'
        href='/security/file/{{this.file.id}}'
        target='_blank'
        rel='noopener noreferrer'
        data-test-vulnerability-analysis-editAnalysesLink
      >
        <:leftIcon>
          <AkIcon @iconName='edit' />
        </:leftIcon>

        <:default>
          <AkTypography @tag='span' @color='inherit' @noWrap={{true}}>
            {{t 'editAnalyses'}}
          </AkTypography>
        </:default>
      </AkButton>
    {{/if}}

    <div {{style width='120px'}}>
      <AkSelect
        data-test-vulnerability-analysis-filterSelect
        @onChange={{this.filterVulnerabilityType}}
        @options={{this.vulnerabilityTypes}}
        @selected={{this.vulnerabilityType}}
        @triggerClass={{this.classes.vulnerabilityTypeFilterSelectTrigger}}
        as |aks|
      >
        {{#if (eq aks -1)}}
          {{t 'allScans'}}
        {{else}}
          {{t (vulnerability-type aks)}}
        {{/if}}
      </AkSelect>
    </div>
  </AkStack>
</AkStack>

<div class='px-2'>
  <AkTable @hoverable={{true}} data-test-vulnerability-analysis-table as |t|>
    <t.head
      data-test-vulnerability-analysis-thead
      @sorts={{this.analysesSorts}}
      @onUpdateSorts={{this.updateAnalysesSorts}}
      @columns={{this.columns}}
      as |h|
    >
      <h.row as |r|>
        <r.cell as |columnValue columnMeta|>
          {{columnValue.name}}

          {{#if columnMeta.isSorted}}
            <AkIcon
              {{style verticalAlign='middle'}}
              @iconName={{if
                columnMeta.isSortedAsc
                'arrow-drop-up'
                'arrow-drop-down'
              }}
            />
          {{/if}}
        </r.cell>
      </h.row>
    </t.head>
    <t.body @rows={{this.finalUnsortedAnalyses}} as |b|>
      <b.row
        {{style cursor='pointer'}}
        @onClick={{this.handleAnalysisClick}}
        data-test-vulnerability-analysis-row
        as |r|
      >
        <r.cell data-test-vulnerability-analysis-cell as |value|>
          {{#if r.columnValue.component}}
            {{#let (component r.columnValue.component) as |Component|}}
              <Component @analysis={{r.rowValue}} />
            {{/let}}
          {{else}}
            <AkTypography>
              {{value}}
            </AkTypography>
          {{/if}}
        </r.cell>
      </b.row>
    </t.body>
  </AkTable>
</div>