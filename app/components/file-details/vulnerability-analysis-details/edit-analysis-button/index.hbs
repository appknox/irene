{{#if this.me.org.is_admin}}
  {{#if @analysis.isRisky}}
    <AkButton
      {{on 'click' this.openEditAnalysisModal}}
      data-test-analysisDetails-editAnalysisBtn
    >
      <:leftIcon>
        <AkIcon @iconName='edit' />
      </:leftIcon>

      <:default>{{t 'editAnalysis'}}</:default>
    </AkButton>

    {{#if this.showEditAnalysisModal}}
      <AkModal
        @showHeader={{true}}
        @headerTitle={{t 'editAnalysis'}}
        @onClose={{this.closeEditAnalysisModal}}
        @noGutter={{true}}
      >
        <div local-class='edit-analysis-modal-header'>
          <AkTypography
            @variant='h6'
            @fontWeight='bold'
            data-test-analysisDetails-editAnalysisModal-vulnerabilityName
          >
            {{@analysis.vulnerability.name}}
          </AkTypography>
        </div>

        <div local-class='edit-analysis-modal-body'>
          {{#if @analysis.isRisky}}
            <AkTypography
              data-test-analysisDetails-editAnalysisModal-overrideRiskTitle
              @variant='subtitle2'
              @fontWeight='bold'
              class='uppercase-text'
            >
              {{t 'overrideRisk'}}
            </AkTypography>
            {{#if @analysis.isOverriddenRisk}}
              {{#if this.isEditingOverriddenRisk}}
                <FileDetails::VulnerabilityAnalysisDetails::EditAnalysisForm
                  @analysis={{@analysis}}
                  @isEditingOverriddenRisk={{this.isEditingOverriddenRisk}}
                  @handleEditOverriddenRiskCancel={{this.cancelEditMarkingAnalysis}}
                />
              {{else}}
                <AkStack class='mt-2' @alignItems='center' @spacing='2'>
                  <AkTypography
                    data-test-analysisDetails-editAnalysisModal-orginalRiskTitle
                    @variant='subtitle2'
                    @fontWeight='bold'
                    @color='textSecondary'
                    {{style width='120px'}}
                  >
                    {{t 'orginalRisk'}}
                  </AkTypography>

                  <AnalysisRisk::Tag
                    data-test-analysisDetails-editAnalysisModal-orginalRisk
                    @computedRisk={{@analysis.risk}}
                  />
                </AkStack>

                <AkStack class='my-2' @alignItems='center' @spacing='2'>
                  <AkTypography
                    data-test-analysisDetails-editAnalysisModal-overriddenRiskTitle
                    @variant='subtitle2'
                    @fontWeight='bold'
                    @color='textSecondary'
                    {{style width='120px'}}
                  >
                    {{t 'overriddenRisk'}}
                  </AkTypography>

                  <AnalysisRisk::Tag
                    data-test-analysisDetails-editAnalysisModal-overriddenRisk
                    @computedRisk={{@analysis.overriddenRisk}}
                  />
                </AkStack>

                <AkStack @alignItems='center' @spacing='2'>
                  <AkTypography
                    data-test-analysisDetails-editAnalysisModal-overriddenCommentLabel
                    @variant='subtitle2'
                    @fontWeight='bold'
                    @color='textSecondary'
                    {{style width='120px'}}
                  >
                    {{t 'comment'}}
                  </AkTypography>

                  <AkTypography
                    data-test-analysisDetails-editAnalysisModal-overriddenComment
                  >
                    {{#if @analysis.overriddenRiskComment}}
                      {{@analysis.overriddenRiskComment}}
                    {{else}}
                      <em>
                        {{t 'none'}}
                      </em>
                    {{/if}}
                  </AkTypography>
                </AkStack>

                <AkDivider class='my-2' />

                <AkStack @alignItems='center' @spacing='2'>
                  <AkButton
                    data-test-analysisDetails-editAnalysisModal-editOverriddenBtn
                    {{on 'click' this.editMarkedAnalysis}}
                  >
                    {{t 'edit'}}
                  </AkButton>

                  <AkButton
                    data-test-analysisDetails-editAnalysisModal-resetOverriddenBtn
                    @variant='outlined'
                    @color='neutral'
                    {{on 'click' this.openResetMarkedAnalysisConfirmBox}}
                  >
                    {{t 'reset'}}
                  </AkButton>
                </AkStack>
              {{/if}}
            {{else}}
              <FileDetails::VulnerabilityAnalysisDetails::EditAnalysisForm
                @analysis={{@analysis}}
              />
            {{/if}}
          {{/if}}
        </div>
      </AkModal>
    {{/if}}

    <ConfirmBox
      @isActive={{this.showResetAnalysisConfirmBox}}
      @title={{t 'resetOverriddenAnalysis'}}
      @delegate={{this}}
      @disabled={{this.isResettingMarkedAnalysis}}
    />
  {{/if}}
{{/if}}