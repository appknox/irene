<div local-class='analysis-details-root' data-test-analysis-details-container>
  {{#if @showHeader}}
    <header
      data-test-analysisDetails-header
      local-class='analysis-details-header'
    >
      <AkBreadcrumbs::Container
        data-test-vulnerabilityAnalysisDetails-breadcrumbContainer
      >
        {{#each this.breadcrumbItems as |item|}}
          <AkBreadcrumbs::Item
            @route={{item.route}}
            @models={{item.models}}
            @linkTitle={{item.linkTitle}}
            data-test-vulnerabilityAnalysisDetails-breadcrumbItem='{{item.linkTitle}}'
          />
        {{/each}}
      </AkBreadcrumbs::Container>

      <AkStack class='mt-4' @alignItems='center' @spacing='5'>
        <AkStack
          data-test-analysisDetails-headerSummaryGroup='{{t "impact"}}'
          @direction='column'
          @spacing='1.5'
        >
          <AkTypography
            data-test-analysisDetails-headerSummaryTitle
            @variant='h6'
          >
            {{t 'impact'}}
          </AkTypography>

          <RiskTag @analysis={{@analysis}} @columnSize='is-one-sixth' />
        </AkStack>

        <AkStack
          data-test-analysisDetails-headerSummaryGroup='{{t "title"}}'
          @direction='column'
          @spacing='1.5'
        >
          <AkTypography
            data-test-analysisDetails-headerSummaryTitle
            @variant='h6'
          >
            {{t 'title'}}
          </AkTypography>

          <AkTypography data-test-analysisDetails-headerSummaryValue>
            {{@analysis.vulnerability.name}}
          </AkTypography>
        </AkStack>

        <AkStack
          data-test-analysisDetails-headerSummaryGroup='{{t "typeOfScan"}}'
          {{style flex='1'}}
          @direction='column'
          @spacing='1.5'
        >
          <AkTypography
            data-test-analysisDetails-headerSummaryTitle
            @variant='h6'
          >
            {{t 'typeOfScan'}}
          </AkTypography>

          <FileDetails::TypeOfScan
            @analysis={{@analysis}}
            @chipSize='medium'
            @justifyContent='flex-start'
            @tooltipPlacement='bottom'
          />
        </AkStack>

        <div>
          <FileDetails::VulnerabilityAnalysisDetails::EditAnalysisButton
            @analysis={{@analysis}}
          />
        </div>
      </AkStack>
    </header>
  {{/if}}

  <AkStack @direction='column' @spacing='3' class='my-3 px-3'>
    <AkStack @direction='column' @spacing='1'>
      <AkTypography data-test-analysisDetails-descriptionLabel @variant='h5'>
        {{t 'description'}}
      </AkTypography>

      <AkTypography
        data-test-analysisDetails-descriptionValue
        local-class='analysis-content analysis-static-content'
        @tag='div'
      >
        {{this.vulnerabilityDescription}}
      </AkTypography>
    </AkStack>

    <AkDivider @color='dark' />

    {{#if @analysis.isRisky}}
      {{#if (and (eq @analysis.cvssVersion 3) @analysis.cvssVector)}}
        <AkStack @direction='column' @spacing='2' @width='full'>
          <AkTypography data-test-analysisDetails-cvssTitle @variant='h5'>
            {{t 'cvss'}}
          </AkTypography>

          <AkStack data-test-analysisDetails-regulatory='cvssv3'>
            <AkTypography
              @variant='h6'
              local-class='analysis-content-title'
              title='{{t "cvssExpansion"}}'
              data-test-analysisDetails-regulatoryLabel
            >
              {{t 'cvssV3'}}
            </AkTypography>

            <AkTypography
              local-class='analysis-content-value'
              data-test-analysisDetails-regulatoryValue
              class='column black-text'
            >
              {{@analysis.cvssBase}}
            </AkTypography>
          </AkStack>

          <AkDivider />

          <div data-test-analysisDetails-regulatory='cvssv3metrics'>
            <AkTypography
              @variant='h6'
              @gutterBottom={{true}}
              data-test-analysisDetails-regulatoryLabel
            >
              {{t 'cvssMetrics'}}
            </AkTypography>

            <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
              @contents={{@analysis.cvssMetricsHumanized}}
            >
              <:label as |metric|>
                <AkTypography>
                  {{metric.key}}
                </AkTypography>
              </:label>

              <:value as |metric|>
                <AkTypography>
                  {{metric.value}}
                </AkTypography>
              </:value>
            </FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent>
          </div>
        </AkStack>

        <AkDivider @color='dark' />
      {{/if}}

      <div data-test-analysisDetails-vulnerabilityContainer>
        <AkTypography
          data-test-analysisDetails-vulnerabilityTitle
          @variant='h5'
          @gutterBottom={{true}}
        >
          {{t 'vulnerability'}}
        </AkTypography>

        <div class='my-2'>
          {{#each @analysis.findings as |finding idx|}}
            {{#if finding.title}}
              <AkTypography
                data-test-analysisDetails-vulFindingTitle='{{idx}}'
                local-class='analysis-content-value'
              >
                {{finding.title}}
              </AkTypography>
            {{/if}}

            <div local-class='vulnerabiliy-finding-container'>
              <pre
                data-test-analysisDetails-vulFindingDescription='{{idx}}'
                local-class='vulnerabiliy-finding-description'
              >
                {{finding.description}}
              </pre>
            </div>
          {{/each}}
        </div>
      </div>

      <AkDivider @color='dark' />

      {{#if @analysis.vulnerability.compliant}}
        <AkStack @direction='column' @spacing='1.5'>
          <AkTypography data-test-analysisDetails-compliantLabel @variant='h5'>
            {{t 'compliantSolution'}}
          </AkTypography>

          <AkTypography
            data-test-analysisDetails-compliantValue
            local-class='analysis-content analysis-static-content'
            @tag='div'
          >
            {{this.compliantSolution}}
          </AkTypography>
        </AkStack>

        <AkDivider @color='dark' />
      {{/if}}

      {{#if @analysis.vulnerability.nonCompliant}}
        <AkStack @direction='column' @spacing='1.5'>
          <AkTypography
            data-test-analysisDetails-nonCompliantLabel
            @variant='h5'
          >
            {{t 'nonCompliantCodeExample'}}
          </AkTypography>

          <AkTypography
            data-test-analysisDetails-nonCompliantValue
            local-class='analysis-content analysis-static-content'
            @tag='div'
          >
            {{this.nonCompliantCodeExample}}
          </AkTypography>
        </AkStack>

        <AkDivider @color='dark' />
      {{/if}}

      {{#if this.hasRegulatoryContent}}
        <AkStack @direction='column' @spacing='2' @width='full'>
          <AkTypography
            data-test-analysisDetails-regulatoryContentTitle
            @variant='h5'
          >
            {{t 'regulatory'}}
          </AkTypography>

          {{#if this.regulatoryContent.owasp}}
            <div data-test-analysisDetails-regulatory='owasp'>
              <AkTypography
                title='{{t "owaspExpansion"}}'
                data-test-analysisDetails-regulatoryLabel
                @variant='h6'
                @gutterBottom={{true}}
              >
                {{t 'owasp'}}
              </AkTypography>

              <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
                @contents={{this.regulatoryContent.owasp}}
              />
            </div>

            <AkDivider />
          {{/if}}

          {{#if this.regulatoryContent.cwe}}
            <div data-test-analysisDetails-regulatory='cwe'>
              <AkTypography
                data-test-analysisDetails-regulatoryLabel
                title='{{t "cweExpansion"}}'
                @variant='h6'
                @gutterBottom={{true}}
              >
                {{t 'cwe'}}
              </AkTypography>

              <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
                @contents={{this.regulatoryContent.cwe}}
              >
                <:value as |cwe|>
                  <AkButton
                    data-test-analysisDetails-regulatoryValue
                    @tag='a'
                    @variant='text'
                    @color='primary'
                    href='{{cwe.url}}'
                    target='_blank'
                    rel='noopener noreferrer'
                  >
                    {{cwe.url}}
                  </AkButton>
                </:value>
              </FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent>
            </div>

            <AkDivider />
          {{/if}}

          {{#if this.regulatoryContent.asvs}}
            <div data-test-analysisDetails-regulatory='asvs'>
              <AkTypography
                title='{{t "asvsExpansion"}}'
                data-test-analysisDetails-regulatoryLabel
                @variant='h6'
                @gutterBottom={{true}}
              >
                {{t 'asvs'}}
              </AkTypography>

              <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
                @contents={{this.regulatoryContent.asvs}}
              />
            </div>
          {{/if}}

          {{#if this.regulatoryContent.mstg}}
            <div data-test-analysisDetails-regulatory='mstg'>
              <AkTypography
                data-test-analysisDetails-regulatoryLabel
                title='{{t "mstgExpansion"}}'
                @variant='h6'
                @gutterBottom={{true}}
              >
                {{t 'mstg'}}
              </AkTypography>

              <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
                @contents={{this.regulatoryContent.mstg}}
              />
            </div>

            <AkDivider />
          {{/if}}

          {{#if @analysis.showPcidss}}
            {{#if this.regulatoryContent.pcidss}}
              <div data-test-analysisDetails-regulatory='pcidss'>
                <AkTypography
                  data-test-analysisDetails-regulatoryLabel
                  title='{{t "pcidssExpansion"}}'
                  @variant='h6'
                  @gutterBottom={{true}}
                >
                  {{t 'pcidss'}}
                </AkTypography>

                <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
                  @contents={{this.regulatoryContent.pcidss}}
                  @hasMoreDetails={{true}}
                />
              </div>

              <AkDivider />
            {{/if}}
          {{/if}}

          {{#if @analysis.showHipaa}}
            {{#if this.regulatoryContent.hipaa}}
              <div data-test-analysisDetails-regulatory='hipaa'>
                <AkTypography
                  data-test-analysisDetails-regulatoryLabel
                  title='{{t "hipaaExpansion"}}'
                  @variant='h6'
                  @gutterBottom={{true}}
                >
                  {{t 'hipaa'}}
                </AkTypography>

                <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
                  @contents={{this.regulatoryContent.hipaa}}
                >
                  <:value as |hipaa showMoreFor showMoreHandler|>
                    <AkTypography @tag='div'>
                      {{hipaa.safeguard}}:
                      {{hipaa.title}}

                      {{#if (eq showMoreFor hipaa.id)}}
                        <br />

                        <div
                          data-test-analysisDetail-regulatoryContent-valueStandardTitle
                          class='my-2'
                        >
                          <strong>{{t 'standards'}}</strong>
                        </div>

                        <AkStack class='mb-2' @direction='column' @spacing='3'>
                          {{#each hipaa.standards as |std|}}
                            <div
                              data-test-analysisDetail-regulatoryContent-valueStandardGroup
                            >
                              <div
                                data-test-analysisDetail-regulatoryContent-valueStandardLabel
                                class='mb-1'
                              >
                                <AkTypography @tag='span' @variant='h6'>
                                  {{std.title}}
                                </AkTypography>

                                <AkTypography
                                  @color='textSecondary'
                                  @tag='span'
                                >
                                  ({{std.specifications}})
                                </AkTypography>
                              </div>

                              <AkTypography
                                data-test-analysisDetail-regulatoryContent-valueStandardDescription
                              >
                                {{std.description}}
                              </AkTypography>
                            </div>
                          {{/each}}
                        </AkStack>
                      {{/if}}

                      <AkButton
                        @variant='text'
                        @color='primary'
                        @underline='always'
                        {{on 'click' (fn showMoreHandler hipaa.id)}}
                        data-test-analysisDetail-regulatoryContent-valueMoreLessBtn
                      >
                        {{if
                          (eq showMoreFor hipaa.id)
                          (t 'lessDetails')
                          (t 'moreDetails')
                        }}
                      </AkButton>
                    </AkTypography>
                  </:value>
                </FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent>
              </div>

              <AkDivider />
            {{/if}}
          {{/if}}

          {{#if @analysis.showGdpr}}
            {{#if this.regulatoryContent.gdpr}}
              <div data-test-analysisDetails-regulatory='gdpr'>
                <AkTypography
                  data-test-analysisDetails-regulatoryLabel
                  title='{{t "gdprExpansion"}}'
                  @variant='h6'
                  @gutterBottom={{true}}
                >
                  {{t 'gdpr'}}
                </AkTypography>

                <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
                  @contents={{this.regulatoryContent.gdpr}}
                />
              </div>
            {{/if}}
          {{/if}}
        </AkStack>
      {{/if}}

      {{#if @analysis.vulnerability.businessImplication}}
        <AkDivider @color='dark' />

        <AkStack @direction='column' @spacing='1'>
          <AkTypography
            data-test-analysisDetails-bussinessImpLabel
            @variant='h5'
          >
            {{t 'businessImplication'}}
          </AkTypography>

          <AkTypography
            data-test-analysisDetails-bussinessImpValue
            local-class='analysis-content analysis-static-content'
            @tag='div'
          >
            {{this.businessImplication}}
          </AkTypography>
        </AkStack>
      {{/if}}
    {{/if}}

    {{#if @analysis.attachments}}
      <AkDivider @color='dark' />

      <AkStack @direction='column' @spacing='1'>
        <AkTypography
          data-test-analysisDetails-attachmentsTitle
          @variant='h6'
          @gutterBottom={{true}}
        >
          {{t 'attachments'}}
        </AkTypography>

        {{#each @analysis.attachments as |attachment|}}
          <FileDetails::VulnerabilityAnalysisDetails::Attachment
            @attachment={{attachment}}
          />
        {{/each}}
      </AkStack>
    {{/if}}
  </AkStack>
</div>