<div local-class='analysis-details-root' data-test-analysis-details-container>
  <header
    data-test-cy='analysisDetails-header'
    data-test-analysisDetails-header
    local-class='analysis-details-header'
  >
    <div local-class='analysis-details-header-root'>
      <div local-class='analysis-details-header-container'>
        <AkBreadcrumbs::AutoTrail
          data-test-vulnerabilityAnalysisDetails-breadcrumbContainer
        />

        <AkStack
          data-test-analysisDetails-headerSummaryContainer
          class='mt-4'
          @alignItems='center'
          @spacing='2'
        >
          <AkStack
            @spacing='2'
            @alignItems='center'
            local-class='summary-container'
          >
            <AkTypography
              data-test-analysisDetails-headerSummaryValue
              {{style maxWidth='400px'}}
              @variant='h5'
            >
              {{@analysis.vulnerability.name}}
            </AkTypography>

            <AkDivider @direction='vertical' @color='dark' />

            <FileDetails::TypeOfScan
              @analysis={{@analysis}}
              @chipSize='small'
              @justifyContent='flex-start'
              @tooltipPlacement='bottom'
            />
          </AkStack>

          <AkStack @alignItems='stretch' @spacing='2'>
            <AnalysisRisk::Tag
              @computedRisk={{@analysis.computedRisk}}
              @status={{@analysis.status}}
              @isOverridden={{@analysis.isNonPassedRiskOverridden}}
              @overriddenRisk={{@analysis.overriddenRisk}}
              @originalRisk={{@analysis.risk}}
            />

            <div>
              <FileDetails::VulnerabilityAnalysisDetails::EditAnalysisButton
                @analysis={{@analysis}}
              />
            </div>
          </AkStack>
        </AkStack>
      </div>
    </div>
  </header>

  <div local-class='analysis-details-body-container'>
    <AkStack
      local-class='analysis-section {{if
        @analysis.isOverriddenAsPassed
        "analysis-overridden-passed"
      }}'
      @direction='column'
      class='mb-2'
    >
      <div local-class='analysis-content-title-container'>
        <AkTypography
          data-test-analysisDetails-descriptionLabel
          @variant='subtitle1'
        >
          {{t 'description'}}
        </AkTypography>
      </div>

      <AkStack local-class='analysis-content-container'>
        <AkTypography
          data-test-analysisDetails-descriptionValue
          local-class='analysis-content analysis-static-content'
          @tag='div'
        >
          {{this.vulnerabilityDescription}}
        </AkTypography>
      </AkStack>
    </AkStack>

    {{#if this.showSystemPassedFindings}}
      <FileDetails::VulnerabilityAnalysisDetails::Findings
        @analysis={{@analysis}}
      />

    {{else if (or @analysis.isRisky @analysis.isOverriddenAsPassed)}}
      {{#if (and (eq @analysis.cvssVersion 3) @analysis.cvssVector)}}
        <div
          local-class='
            analysis-section
            analysis-section-container
            {{if @analysis.isOverriddenAsPassed "analysis-overridden-passed"}}
          '
        >
          <AkStack data-test-analysisDetails-regulatory='cvssv3' class='p-2'>
            <AkTypography
              @variant='subtitle1'
              local-class='analysis-content-label'
              title='{{t "cvssExpansion"}}'
              data-test-analysisDetails-regulatoryLabel
            >
              {{t 'cvssV3'}}
            </AkTypography>

            <AkTypography
              local-class='analysis-content-value'
              data-test-analysisDetails-regulatoryValue
            >
              {{@analysis.cvssBase}}
            </AkTypography>
          </AkStack>
        </div>

        <div
          local-class='analysis-section {{if
            @analysis.isOverriddenAsPassed
            "analysis-overridden-passed"
          }}'
          data-test-analysisDetails-regulatory='cvssv3metrics'
        >
          <div local-class='analysis-content-title-container'>
            <AkTypography
              @variant='subtitle1'
              data-test-analysisDetails-regulatoryLabel
            >
              {{t 'cvssMetrics'}}
            </AkTypography>
          </div>

          <div local-class='analysis-content-container'>
            <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
              @contents={{@analysis.cvssMetricsHumanized}}
            >
              <:label as |metric|>
                <AkTypography>
                  {{metric.key}}
                </AkTypography>
              </:label>

              <:value as |metric|>
                <AkTypography>
                  {{metric.value}}
                </AkTypography>
              </:value>
            </FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent>
          </div>
        </div>
      {{/if}}

      <FileDetails::VulnerabilityAnalysisDetails::Findings
        @analysis={{@analysis}}
      />

      {{#if @analysis.vulnerability.compliant}}
        <AkStack
          local-class='analysis-section {{if
            @analysis.isOverriddenAsPassed
            "analysis-overridden-passed"
          }}'
          @direction='column'
        >
          <div local-class='analysis-content-title-container'>
            <AkTypography
              data-test-analysisDetails-compliantLabel
              @variant='subtitle1'
            >
              {{t 'compliantSolution'}}
            </AkTypography>
          </div>

          <div local-class='analysis-content-container'>
            <AkTypography
              data-test-analysisDetails-compliantValue
              local-class='analysis-content analysis-static-content'
              @tag='div'
            >
              {{this.compliantSolution}}
            </AkTypography>
          </div>
        </AkStack>
      {{/if}}

      {{#if @analysis.vulnerability.nonCompliant}}
        <AkStack
          local-class='analysis-section {{if
            @analysis.isOverriddenAsPassed
            "analysis-overridden-passed"
          }}'
          @direction='column'
        >
          <div local-class='analysis-content-title-container'>
            <AkTypography
              data-test-analysisDetails-nonCompliantLabel
              @variant='subtitle1'
            >
              {{t 'nonCompliantCodeExample'}}
            </AkTypography>
          </div>

          <div local-class='analysis-content-container'>
            <AkTypography
              data-test-analysisDetails-nonCompliantValue
              local-class='analysis-content analysis-static-content'
              @tag='div'
            >
              {{this.nonCompliantCodeExample}}
            </AkTypography>
          </div>
        </AkStack>
      {{/if}}

      {{#if this.hasRegulatoryContent}}
        <AkStack
          local-class='analysis-section analysis-regulatory-section {{if
            @analysis.isOverriddenAsPassed
            "analysis-overridden-passed"
          }}'
          @direction='column'
          @width='full'
        >
          <div local-class='analysis-content-title-container'>
            <AkTypography
              data-test-analysisDetails-regulatoryContentTitle
              @variant='subtitle1'
            >
              {{t 'regulatory'}}
            </AkTypography>
          </div>

          <div local-class='analysis-content-container'>
            {{#each this.regulatoryContent as |rc|}}
              {{#if rc.hasContent}}
                <div
                  class='mt-2'
                  local-class='analysis-regulatory-content'
                  data-test-analysisDetails-regulatory='{{rc.key}}'
                >
                  <AkTypography
                    title='{{rc.title}}'
                    data-test-analysisDetails-regulatoryLabel
                    @variant='h6'
                    @gutterBottom={{true}}
                  >
                    {{rc.heading}}
                  </AkTypography>

                  {{#if rc.component}}
                    {{#let (component rc.component) as |Component|}}
                      <Component @contents={{rc.contents}} />
                    {{/let}}
                  {{else}}
                    <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
                      @contents={{rc.contents}}
                      @hasMoreDetails={{rc.hasMoreDetails}}
                    />
                  {{/if}}
                </div>
              {{/if}}
            {{/each}}
          </div>
        </AkStack>
      {{/if}}

      {{#if @analysis.vulnerability.businessImplication}}
        <AkStack
          local-class='analysis-section {{if
            @analysis.isOverriddenAsPassed
            "analysis-overridden-passed"
          }}'
          @direction='column'
        >
          <div local-class='analysis-content-title-container'>
            <AkTypography
              data-test-analysisDetails-bussinessImpLabel
              @variant='subtitle1'
            >
              {{t 'businessImplication'}}
            </AkTypography>
          </div>

          <div local-class='analysis-content-container'>
            <AkTypography
              data-test-analysisDetails-bussinessImpValue
              local-class='analysis-content analysis-static-content'
              @tag='div'
            >
              {{this.businessImplication}}
            </AkTypography>
          </div>
        </AkStack>
      {{/if}}
    {{/if}}

    {{#if @analysis.attachments}}
      <AkStack
        local-class='analysis-section {{if
          @analysis.isOverriddenAsPassed
          "analysis-overridden-passed"
        }}'
        @direction='column'
      >
        <div local-class='analysis-content-title-container'>
          <AkTypography
            data-test-analysisDetails-attachmentsTitle
            @variant='subtitle1'
          >
            {{t 'attachments'}}
          </AkTypography>
        </div>

        <div local-class='analysis-content-container'>
          {{#each @analysis.attachments as |attachment|}}
            <AttachmentDetail @attachment={{attachment}} />
          {{/each}}
        </div>
      </AkStack>
    {{/if}}
  </div>
</div>