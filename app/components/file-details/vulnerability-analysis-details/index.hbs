<div local-class='analysis-details-root' data-test-analysis-details-container>
  {{#if @showHeader}}
    <header
      data-test-analysisDetails-header
      local-class='analysis-details-header'
    >
      <AkBreadcrumbs::Container
        data-test-vulnerabilityAnalysisDetails-breadcrumbContainer
      >
        {{#each this.breadcrumbItems as |item|}}
          <AkBreadcrumbs::Item
            @route={{item.route}}
            @models={{item.models}}
            @linkTitle={{item.linkTitle}}
            data-test-vulnerabilityAnalysisDetails-breadcrumbItem='{{item.linkTitle}}'
          />
        {{/each}}
      </AkBreadcrumbs::Container>

      <AkStack class='mt-4' @alignItems='center' @spacing='5'>
        <AkStack
          data-test-analysisDetails-headerSummaryGroup='{{t "impact"}}'
          @direction='column'
          @spacing='1.5'
        >
          <AkTypography
            data-test-analysisDetails-headerSummaryTitle
            @variant='h6'
          >
            {{t 'impact'}}
          </AkTypography>

          <RiskTag @analysis={{@analysis}} @columnSize='is-one-sixth' />
        </AkStack>

        <AkStack
          data-test-analysisDetails-headerSummaryGroup='{{t "title"}}'
          @direction='column'
          @spacing='1.5'
        >
          <AkTypography
            data-test-analysisDetails-headerSummaryTitle
            @variant='h6'
          >
            {{t 'title'}}
          </AkTypography>

          <AkTypography data-test-analysisDetails-headerSummaryValue>
            {{@analysis.vulnerability.name}}
          </AkTypography>
        </AkStack>

        <AkStack
          data-test-analysisDetails-headerSummaryGroup='{{t "typeOfScan"}}'
          {{style flex='1'}}
          @direction='column'
          @spacing='1.5'
        >
          <AkTypography
            data-test-analysisDetails-headerSummaryTitle
            @variant='h6'
          >
            {{t 'typeOfScan'}}
          </AkTypography>

          <FileDetails::TypeOfScan
            @analysis={{@analysis}}
            @chipSize='medium'
            @justifyContent='flex-start'
            @tooltipPlacement='bottom'
          />
        </AkStack>

        <div>
          <FileDetails::VulnerabilityAnalysisDetails::EditAnalysisButton
            @analysis={{@analysis}}
          />
        </div>
      </AkStack>
    </header>
  {{/if}}

  <AkStack @direction='column' @spacing='3' class='my-3 px-3'>
    <AkStack local-class='analysis-section' @direction='column' @spacing='1'>
      <AkTypography data-test-analysisDetails-descriptionLabel @variant='h5'>
        {{t 'description'}}
      </AkTypography>

      <AkTypography
        data-test-analysisDetails-descriptionValue
        local-class='analysis-content analysis-static-content'
        @tag='div'
      >
        {{this.vulnerabilityDescription}}
      </AkTypography>
    </AkStack>

    {{#if @analysis.isRisky}}
      {{#if (and (eq @analysis.cvssVersion 3) @analysis.cvssVector)}}
        <AkStack
          local-class='analysis-section'
          @direction='column'
          @spacing='2'
          @width='full'
        >
          <AkTypography data-test-analysisDetails-cvssTitle @variant='h5'>
            {{t 'cvss'}}
          </AkTypography>

          <AkStack data-test-analysisDetails-regulatory='cvssv3'>
            <AkTypography
              @variant='h6'
              local-class='analysis-content-title'
              title='{{t "cvssExpansion"}}'
              data-test-analysisDetails-regulatoryLabel
            >
              {{t 'cvssV3'}}
            </AkTypography>

            <AkTypography
              local-class='analysis-content-value'
              data-test-analysisDetails-regulatoryValue
              class='column black-text'
            >
              {{@analysis.cvssBase}}
            </AkTypography>
          </AkStack>

          <AkDivider />

          <div data-test-analysisDetails-regulatory='cvssv3metrics'>
            <AkTypography
              @variant='h6'
              @gutterBottom={{true}}
              data-test-analysisDetails-regulatoryLabel
            >
              {{t 'cvssMetrics'}}
            </AkTypography>

            <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
              @contents={{@analysis.cvssMetricsHumanized}}
            >
              <:label as |metric|>
                <AkTypography>
                  {{metric.key}}
                </AkTypography>
              </:label>

              <:value as |metric|>
                <AkTypography>
                  {{metric.value}}
                </AkTypography>
              </:value>
            </FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent>
          </div>
        </AkStack>
      {{/if}}

      <div
        local-class='analysis-section'
        data-test-analysisDetails-vulnerabilityContainer
      >
        <AkTypography
          data-test-analysisDetails-vulnerabilityTitle
          @variant='h5'
          @gutterBottom={{true}}
        >
          {{t 'vulnerability'}}
        </AkTypography>

        <div class='my-2'>
          {{#each @analysis.findings as |finding idx|}}
            {{#if finding.title}}
              <AkTypography
                data-test-analysisDetails-vulFindingTitle='{{idx}}'
                local-class='analysis-content-value'
              >
                {{finding.title}}
              </AkTypography>
            {{/if}}

            <div local-class='vulnerabiliy-finding-container'>
              <pre
                data-test-analysisDetails-vulFindingDescription='{{idx}}'
                local-class='vulnerabiliy-finding-description'
              >
                {{finding.description}}
              </pre>
            </div>
          {{/each}}
        </div>
      </div>

      {{#if @analysis.vulnerability.compliant}}
        <AkStack
          local-class='analysis-section'
          @direction='column'
          @spacing='1.5'
        >
          <AkTypography data-test-analysisDetails-compliantLabel @variant='h5'>
            {{t 'compliantSolution'}}
          </AkTypography>

          <AkTypography
            data-test-analysisDetails-compliantValue
            local-class='analysis-content analysis-static-content'
            @tag='div'
          >
            {{this.compliantSolution}}
          </AkTypography>
        </AkStack>
      {{/if}}

      {{#if @analysis.vulnerability.nonCompliant}}
        <AkStack
          local-class='analysis-section'
          @direction='column'
          @spacing='1.5'
        >
          <AkTypography
            data-test-analysisDetails-nonCompliantLabel
            @variant='h5'
          >
            {{t 'nonCompliantCodeExample'}}
          </AkTypography>

          <AkTypography
            data-test-analysisDetails-nonCompliantValue
            local-class='analysis-content analysis-static-content'
            @tag='div'
          >
            {{this.nonCompliantCodeExample}}
          </AkTypography>
        </AkStack>
      {{/if}}

      {{#if this.hasRegulatoryContent}}
        <AkStack
          local-class='analysis-section'
          @direction='column'
          @spacing='2'
          @width='full'
        >
          <AkTypography
            data-test-analysisDetails-regulatoryContentTitle
            @variant='h5'
          >
            {{t 'regulatory'}}
          </AkTypography>

          {{#each this.regulatoryContent as |rc|}}
            {{#if rc.hasContent}}
              <div data-test-analysisDetails-regulatory='{{rc.key}}'>
                <AkTypography
                  title='{{rc.title}}'
                  data-test-analysisDetails-regulatoryLabel
                  @variant='h6'
                  @gutterBottom={{true}}
                >
                  {{rc.heading}}
                </AkTypography>

                {{#if rc.component}}
                  {{#let (component rc.component) as |Component|}}
                    <Component @contents={{rc.contents}} />
                  {{/let}}
                {{else}}
                  <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
                    @contents={{rc.contents}}
                    @hasMoreDetails={{rc.hasMoreDetails}}
                  />
                {{/if}}
              </div>

              {{#if (not-eq rc this.regulatoryContent.lastObject)}}
                <AkDivider />
              {{/if}}
            {{/if}}
          {{/each}}
        </AkStack>
      {{/if}}

      {{#if @analysis.vulnerability.businessImplication}}
        <AkStack
          local-class='analysis-section'
          @direction='column'
          @spacing='1'
        >
          <AkTypography
            data-test-analysisDetails-bussinessImpLabel
            @variant='h5'
          >
            {{t 'businessImplication'}}
          </AkTypography>

          <AkTypography
            data-test-analysisDetails-bussinessImpValue
            local-class='analysis-content analysis-static-content'
            @tag='div'
          >
            {{this.businessImplication}}
          </AkTypography>
        </AkStack>
      {{/if}}
    {{/if}}

    {{#if @analysis.attachments}}
      <AkStack local-class='analysis-section' @direction='column' @spacing='1'>
        <AkTypography
          data-test-analysisDetails-attachmentsTitle
          @variant='h6'
          @gutterBottom={{true}}
        >
          {{t 'attachments'}}
        </AkTypography>

        {{#each @analysis.attachments as |attachment|}}
          <FileDetails::VulnerabilityAnalysisDetails::Attachment
            @attachment={{attachment}}
          />
        {{/each}}
      </AkStack>
    {{/if}}
  </AkStack>
</div>