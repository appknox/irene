<div local-class='analysis-details-root' data-test-analysis-details-container>
  <header
    data-test-analysisDetails-header
    local-class='analysis-details-header'
  >
    <div local-class='analysis-details-header-container'>
      <AkBreadcrumbs::Container
        data-test-vulnerabilityAnalysisDetails-breadcrumbContainer
      >
        {{#each this.breadcrumbItems as |item|}}
          <AkBreadcrumbs::Item
            @route={{item.route}}
            @models={{item.models}}
            @linkTitle={{item.linkTitle}}
            data-test-vulnerabilityAnalysisDetails-breadcrumbItem='{{item.linkTitle}}'
          />
        {{/each}}
      </AkBreadcrumbs::Container>

      <AkStack class='mt-4' @alignItems='flex-end' @spacing='2'>
        <AkStack @spacing='4.5' {{style flex='1'}}>
          <AkStack
            data-test-analysisDetails-headerSummaryGroup='{{t "title"}}'
            @direction='column'
            @spacing='1.5'
          >
            <AkTypography
              data-test-analysisDetails-headerSummaryTitle
              @tag='h6'
            >
              {{t 'testCase'}}
            </AkTypography>

            <AkTypography
              data-test-analysisDetails-headerSummaryValue
              {{style maxWidth='400px'}}
              @variant='h5'
            >
              {{@analysis.vulnerability.name}}
            </AkTypography>
          </AkStack>

          <AkStack
            data-test-analysisDetails-headerSummaryGroup='{{t "typeOfScan"}}'
            @direction='column'
            @spacing='1.5'
          >
            <AkTypography
              data-test-analysisDetails-headerSummaryTitle
              @tag='h6'
            >
              {{t 'typeOfScan'}}
            </AkTypography>

            <FileDetails::TypeOfScan
              @analysis={{@analysis}}
              @chipSize='small'
              @justifyContent='flex-start'
              @tooltipPlacement='bottom'
            />
          </AkStack>
        </AkStack>

        <AkStack @alignItems='stretch' @spacing='2'>
          <AnalysisRisk::Tag
            @computedRisk={{@analysis.computedRisk}}
            @status={{@analysis.status}}
            @isOverridden={{@analysis.isNonPassedRiskOverridden}}
            @overriddenRisk={{@analysis.overriddenRisk}}
            @originalRisk={{@analysis.risk}}
          />

          <div>
            <FileDetails::VulnerabilityAnalysisDetails::EditAnalysisButton
              @analysis={{@analysis}}
            />
          </div>
        </AkStack>
      </AkStack>
    </div>
  </header>

  <div local-class='analysis-details-body-container'>
    <AkStack
      local-class='analysis-section {{if
        @analysis.isOverriddenAsPassed
        "analysis-overridded-passed"
      }}'
      @direction='column'
      class='mb-2'
    >
      <AkStack @width='full' local-class='analysis-content-description-title'>
        <AkTypography
          data-test-analysisDetails-descriptionLabel
          @variant='subtitle1'
        >
          {{t 'description'}}
        </AkTypography>
      </AkStack>

      <AkStack>
        <AkTypography
          data-test-analysisDetails-descriptionValue
          local-class='analysis-content analysis-static-content'
          @tag='div'
        >
          {{this.vulnerabilityDescription}}
        </AkTypography>
      </AkStack>
    </AkStack>

    {{#if this.showSystemPassedFindings}}
      <FileDetails::VulnerabilityAnalysisDetails::Findings
        @analysis={{@analysis}}
      />

    {{else if (or @analysis.isRisky @analysis.isOverriddenAsPassed)}}
      {{#if (and (eq @analysis.cvssVersion 3) @analysis.cvssVector)}}
        <div
          local-class='analysis-section {{if
            @analysis.isOverriddenAsPassed
            "analysis-overridded-passed"
          }}'
        >
          <AkStack data-test-analysisDetails-regulatory='cvssv3' class='p-2'>
            <AkTypography
              @variant='subtitle1'
              local-class='analysis-content-title'
              title='{{t "cvssExpansion"}}'
              data-test-analysisDetails-regulatoryLabel
            >
              {{t 'cvssV3'}}
            </AkTypography>

            <AkTypography
              local-class='analysis-content-value'
              data-test-analysisDetails-regulatoryValue
              class='column black-text'
            >
              {{@analysis.cvssBase}}
            </AkTypography>
          </AkStack>
        </div>

        <div
          local-class='analysis-section {{if
            @analysis.isOverriddenAsPassed
            "analysis-overridded-passed"
          }}'
          data-test-analysisDetails-regulatory='cvssv3metrics'
        >
          <AkTypography
            @variant='subtitle1'
            @gutterBottom={{true}}
            local-class='analysis-content-description-title'
            data-test-analysisDetails-regulatoryLabel
          >
            {{t 'cvssMetrics'}}
          </AkTypography>

          <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
            @contents={{@analysis.cvssMetricsHumanized}}
          >
            <:label as |metric|>
              <AkTypography>
                {{metric.key}}
              </AkTypography>
            </:label>

            <:value as |metric|>
              <AkTypography>
                {{metric.value}}
              </AkTypography>
            </:value>
          </FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent>
        </div>
      {{/if}}

      <FileDetails::VulnerabilityAnalysisDetails::Findings
        @analysis={{@analysis}}
      />

      {{#if @analysis.vulnerability.compliant}}
        <AkStack
          local-class='analysis-section {{if
            @analysis.isOverriddenAsPassed
            "analysis-overridded-passed"
          }}'
          @direction='column'
          @spacing='1.5'
        >
          <AkTypography
            data-test-analysisDetails-compliantLabel
            @variant='subtitle1'
            local-class='analysis-content-description-title'
          >
            {{t 'compliantSolution'}}
          </AkTypography>

          <AkTypography
            data-test-analysisDetails-compliantValue
            local-class='analysis-content analysis-static-content'
            @tag='div'
          >
            {{this.compliantSolution}}
          </AkTypography>
        </AkStack>
      {{/if}}

      {{#if @analysis.vulnerability.nonCompliant}}
        <AkStack
          local-class='analysis-section {{if
            @analysis.isOverriddenAsPassed
            "analysis-overridded-passed"
          }}'
          @direction='column'
          @spacing='1.5'
        >
          <AkTypography
            data-test-analysisDetails-nonCompliantLabel
            local-class='analysis-content-description-title'
            @variant='subtitle1'
          >
            {{t 'nonCompliantCodeExample'}}
          </AkTypography>

          <AkTypography
            data-test-analysisDetails-nonCompliantValue
            local-class='analysis-content analysis-static-content'
            @tag='div'
          >
            {{this.nonCompliantCodeExample}}
          </AkTypography>
        </AkStack>
      {{/if}}

      {{#if this.hasRegulatoryContent}}
        <AkStack
          local-class='analysis-section analysis-regulatory-section {{if
            @analysis.isOverriddenAsPassed
            "analysis-overridded-passed"
          }}'
          @direction='column'
          @spacing='2'
          @width='full'
        >
          <AkTypography
            data-test-analysisDetails-regulatoryContentTitle
            class='px-3 pt-3'
            @variant='subtitle1'
            local-class='analysis-content-regulatory-title'
          >
            {{t 'regulatory'}}
          </AkTypography>

          {{#each this.regulatoryContent as |rc|}}
            {{#if rc.hasContent}}
              <div
                local-class='analysis-regulatory-content'
                data-test-analysisDetails-regulatory='{{rc.key}}'
              >
                <AkTypography
                  title='{{rc.title}}'
                  data-test-analysisDetails-regulatoryLabel
                  @variant='h6'
                  @gutterBottom={{true}}
                >
                  {{rc.heading}}
                </AkTypography>

                {{#if rc.component}}
                  {{#let (component rc.component) as |Component|}}
                    <Component @contents={{rc.contents}} />
                  {{/let}}
                {{else}}
                  <FileDetails::VulnerabilityAnalysisDetails::RegulatoryContent
                    @contents={{rc.contents}}
                    @hasMoreDetails={{rc.hasMoreDetails}}
                  />
                {{/if}}
              </div>
            {{/if}}
          {{/each}}
        </AkStack>
      {{/if}}

      {{#if @analysis.vulnerability.businessImplication}}
        <AkStack
          local-class='analysis-section business-implication-section {{if
            @analysis.isOverriddenAsPassed
            "analysis-overridded-passed"
          }}'
          @direction='column'
          @spacing='1'
        >
          <AkTypography
            data-test-analysisDetails-bussinessImpLabel
            @variant='subtitle1'
            local-class='analysis-content-description-title'
          >
            {{t 'businessImplication'}}
          </AkTypography>

          <AkTypography
            data-test-analysisDetails-bussinessImpValue
            local-class='analysis-content analysis-static-content'
            @tag='div'
          >
            {{this.businessImplication}}
          </AkTypography>
        </AkStack>
      {{/if}}
    {{/if}}

    {{#if @analysis.attachments}}
      <AkStack
        local-class='analysis-section business-implication-section {{if
          @analysis.isOverriddenAsPassed
          "analysis-overridded-passed"
        }}'
        @direction='column'
        @spacing='1'
      >
        <AkTypography
          data-test-analysisDetails-attachmentsTitle
          @variant='subtitle1'
          @gutterBottom={{true}}
          local-class='analysis-content-description-title'
        >
          {{t 'attachments'}}
        </AkTypography>

        {{#each @analysis.attachments as |attachment|}}
          <AttachmentDetail @attachment={{attachment}} />
        {{/each}}
      </AkStack>
    {{/if}}
  </div>
</div>