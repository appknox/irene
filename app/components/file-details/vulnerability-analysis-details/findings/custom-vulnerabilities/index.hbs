<div
  local-class='analysis-section {{if
    @analysis.isOverriddenAsPassed
    "analysis-overridden-passed"
  }}'
  class='mb-2'
  data-test-analysisDetails-vulnerabilityContainer
>
  <AkStack local-class='analysis-content-title'>
    <AkTypography
      data-test-analysisDetails-vulnerabilityTitle
      @variant='subtitle1'
    >
      {{#if
        (and @analysis.isRiskPassedBySystem (gt @analysis.findings.length 0))
      }}
        {{t 'evidences'}}
      {{else}}
        {{t 'vulnerability'}}
      {{/if}}
    </AkTypography>
  </AkStack>

  <div local-class='analysis-content-container' class='p-3'>
    {{#each this.customVulnerableFindings as |finding idx|}}
      {{#if finding.title}}
        <AkTypography
          data-test-analysisDetails-vulFindingTitle='{{idx}}'
          local-class='analysis-content-value'
        >
          {{finding.title}}
        </AkTypography>
      {{/if}}

      <AkStack
        @alignItems='center'
        @spacing='2'
        local-class='vulnerability-finding-row'
      >
        <div local-class='vulnerability-finding-container'>
          <pre
            data-test-analysisDetails-vulFindingDescription='{{idx}}'
            local-class='vulnerability-finding-description'
          >
            {{finding.description}}
          </pre>
        </div>

        {{#if finding.screenshot}}
          <AkIconButton
            local-class='screenshot-button'
            @variant='outlined'
            data-test-analysisDetails-vulFinding-screenshotBtn='{{idx}}'
            {{on 'click' (fn this.openScreenshotModal finding.screenshot)}}
          >
            <AkIcon @iconName='iconoir:screenshot' />
          </AkIconButton>
        {{/if}}
      </AkStack>
    {{/each}}
  </div>
</div>

<AkDrawer
  @open={{this.screenshotDrawerOpen}}
  @onClose={{this.closeScreenshotModal}}
  @anchor='right'
  data-test-analysisDetails-vulFinding-screenshots-drawer
  as |dr|
>
  <AkAppbar @justifyContent='space-between' as |ab|>
    <AkTypography @variant='h5' @color='inherit'>
      {{t 'screenshots'}}
    </AkTypography>

    <AkIconButton
      data-test-analysisDetails-vulFinding-screenshots-closeBtn
      class={{ab.classes.defaultIconBtn}}
      {{on 'click' dr.closeHandler}}
    >
      <AkIcon @iconName='close' />
    </AkIconButton>
  </AkAppbar>

  {{#if this.screenshot}}
    <AkStack
      @alignItems='center'
      @justifyContent='center'
      class='p-2'
      local-class='screenshot-container'
    >
      {{#if this.imageLoading}}
        <div local-class='loading-container'>
          <AkStack @alignItems='center' @spacing='2'>
            <AkLoader @size={{16}} />
            <AkTypography>{{t 'loading'}}...</AkTypography>
          </AkStack>
        </div>
      {{/if}}

      <img
        src={{this.screenshot}}
        alt={{t 'screenshots'}}
        local-class='screenshot-image {{if this.imageLoading "display-none"}}'
        {{on 'load' this.onScreenshotLoad}}
        data-test-analysisDetails-vulFinding-screenshotImage
      />
    </AkStack>
  {{/if}}
</AkDrawer>