<AkBreadcrumbs::AutoTrail />

<AkTypography @variant='h5' class='mt-3'>
  Report Generated by
</AkTypography>

<AkStack
  @justifyContent='space-between'
  @alignItems='center'
  class='mt-3'
  local-class='query-container'
>
  <AkStack @direction='column' @spacing={{1}}>
    <AkTypography @variant='h6'>
      Report Query
    </AkTypography>

    <AkTypography>
      {{@reportRequest.query}}
    </AkTypography>
  </AkStack>

  <AkButton @variant='outlined' @color='neutral'>
    Edit
  </AkButton>
</AkStack>

<div local-class='preview-container' class='mt-3'>
  <AkStack
    @direction='row'
    @justifyContent='space-between'
    @alignItems='center'
    class='p-2'
  >
    <AkButton
      @variant='outlined'
      @disabled={{not @reportRequest.isRelevant}}
      @color='neutral'
      {{on 'click' this.handleFilterDrawerOpen}}
    >
      <:leftIcon>
        <AkIcon
          @iconName='filter-list'
          @color={{if @reportRequest.isRelevant 'primary' 'inherit'}}
        />
      </:leftIcon>

      <:default>
        Filter
      </:default>
    </AkButton>

    <AkButton
      @disabled={{not @reportRequest.isRelevant}}
      @loading={{this.downloadReport.isRunning}}
      {{on 'click' (perform this.downloadReport)}}
    >
      Download Report
    </AkButton>
  </AkStack>

  <AkDivider @color='dark' />

  <div class='p-2' local-class='report-preview'>
    {{#if this.previewReportRequest.isRunning}}
      <AkTable::Loading />
    {{else if this.hasPreviewData}}
      <AkTable
        local-class='report-preview-table'
        @variant='full-bordered'
        as |t|
      >
        <t.head
          @columns={{this.columns}}
          @scrollIndicators='horizontal'
          @columnKeyPath='val_field'
        />

        <t.body @rows={{this.rows}} as |b|>
          <b.row as |r|>
            <r.cell>
              {{#if r.columnValue.component}}
                {{#let (component r.columnValue.component) as |Component|}}
                  <Component @column={{r.columnValue}} @value={{r.rowValue}} />
                {{/let}}
              {{/if}}
            </r.cell>
          </b.row>
        </t.body>
      </AkTable>
    {{else}}
      <AkStack
        @direction='column'
        @alignItems='center'
        @justifyContent='center'
        {{style height='500px'}}
      >
        <AkSvg::NoApisCaptured class='mt-3' />

        <AkStack
          @direction='column'
          @alignItems='center'
          @spacing='1'
          class='mt-3'
        >
          <AkTypography @align='center' @variant='h5'>
            Try to rephrase the prompt with more details
          </AkTypography>

          <AkTypography @align='center' {{style maxWidth='400px'}}>
            Lorem ipsum dolor, sit amet consectetur adipisicing elit. Maxime
            corporis doloremque nisi aliquam nobis! Ratione, ipsum accusamus
            quae.
          </AkTypography>
        </AkStack>
      </AkStack>
    {{/if}}
  </div>
</div>

<AiReporting::Preview::FilterDrawer
  @open={{this.filterDrawerOpen}}
  @onClose={{this.handleFilterDrawerClose}}
  @reportRequest={{@reportRequest}}
  @reportPreview={{this.reportPreview}}
  @onApply={{this.handleFilterDrawerApply}}
  @selectedColumnsMap={{this.filteredColumnsMap}}
/>