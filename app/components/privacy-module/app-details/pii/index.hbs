{{#if this.isFetching}}
  <PrivacyModule::Loader @loadingText='{{t "loading"}}...' />
{{else}}
  {{#if this.showEmptyContent}}
    <PrivacyModule::Status
      @heading={{t 'privacyModule.emptyPiiHeader'}}
      @description={{t 'privacyModule.emptyPiiDesc'}}
      @svgComponent='ak-svg/privacy-not-found'
    />
  {{else}}
    <AkStack
      @justifyContent={{this.justifyContentValue}}
      @alignItems='center'
      local-class='note-power-by-ai'
    >
      {{#if this.piiDataAvailable}}
        <AkTypography data-test-privacyModule-pii-piiDetectedTxt>
          {{t 'privacyModule.piiDetected' htmlSafe=true}}
        </AkTypography>
      {{/if}}

      <PoweredByAi::Chip
        @clickable={{true}}
        @drawerInfo={{this.drawerInfo}}
        data-test-organzation-aiPoweredFeatures-poweredByAiChip
      />
    </AkStack>

    {{#if this.piiDataAvailable}}
      <AkPaginationProvider
        @results={{this.piiDataList}}
        @onItemPerPageChange={{this.handleItemPerPageChange}}
        @totalItems={{this.piiDataCount}}
        @nextAction={{this.handlePrevNextAction}}
        @prevAction={{this.handlePrevNextAction}}
        @itemPerPageOptions={{array 5 10 20}}
        @defaultLimit={{this.limit}}
        @offset={{this.offset}}
        @resultDependencies={{this.resultDependencies}}
        @onResultDependenciesChange={{this.handleResultDependenciesChange}}
        as |pgc|
      >
        <AkTable data-test-privacyModule-pii-list @hoverable={{true}} as |tb|>
          <tb.head @columns={{this.columns}} />
          <tb.body @rows={{pgc.currentPageResults}} as |b|>
            <b.row
              @onClick={{this.openPiiDetailsDrawer}}
              local-class='app-monitoring-table-row'
              {{style cursor='pointer'}}
              as |r|
            >
              <r.cell>
                {{#let (component r.columnValue.component) as |Component|}}
                  <Component @data={{r.rowValue}} @id={{r.rowValue.id}} />
                {{/let}}
              </r.cell>
            </b.row>
          </tb.body>
        </AkTable>

        <AkPagination
          @disableNext={{pgc.disableNext}}
          @nextAction={{pgc.nextAction}}
          @disablePrev={{pgc.disablePrev}}
          @prevAction={{pgc.prevAction}}
          @endItemIdx={{pgc.endItemIdx}}
          @startItemIdx={{pgc.startItemIdx}}
          @itemPerPageOptions={{pgc.itemPerPageOptions}}
          @onItemPerPageChange={{pgc.onItemPerPageChange}}
          @selectedOption={{pgc.selectedOption}}
          @tableItemLabel={{t 'privacyModule.pii'}}
          @perPageTranslation={{t 'recordPerPage'}}
          @totalItems={{pgc.totalItems}}
        />
      </AkPaginationProvider>
    {{else}}
      {{#if this.piiEnabled}}
        <AkStack
          @direction='column'
          @alignItems='center'
          local-class='empty-container'
        >
          <AkSvg::PrivacyUpload />

          <AkTypography
            local-class='body-text'
            class='mt-2'
            data-test-privacyModule-pii-reupload-desc
          >
            {{t 'privacyModule.piiReupload'}}
          </AkTypography>
        </AkStack>
      {{else}}
        <AkStack
          @direction='column'
          @alignItems='center'
          local-class='empty-container'
        >
          <AkSvg::TurnOnSettings />

          <AkTypography
            @variant='h5'
            @gutterBottom={{true}}
            local-class='header'
            data-test-privacyModule-pii-turn-on-feature-header
          >
            {{t 'turnOnFeatureOrgSettings'}}
          </AkTypography>

          <AkTypography
            local-class='body-text'
            data-test-privacyModule-pii-turn-on-feature-desc
          >
            {{t 'privacyModule.turnOnSettingsDesc'}}
          </AkTypography>

          {{#if this.isOwner}}
            <AkButton
              @tag='a'
              href='/dashboard/organization/settings/ai-powered-features'
              target='_blank'
              class='mt-2'
              data-test-privacyModule-pii-turn-on-feature-button
            >
              {{t 'goToOrgSettings'}}
            </AkButton>
          {{/if}}
        </AkStack>
      {{/if}}
    {{/if}}
  {{/if}}
{{/if}}

<AkDrawer
  @open={{this.piiIsSelected}}
  @onClose={{this.closePiiDetailsDrawer}}
  @anchor='right'
  as |dr|
>
  <AkAppbar
    @justifyContent='space-between'
    @position='sticky'
    class='px-3'
    as |ab|
  >
    <AkTypography
      @color='inherit'
      @variant='h5'
      data-test-privacyModule-pii-drawer-header
    >
      {{t 'privacyModule.piiDetails'}}
    </AkTypography>

    <AkIconButton
      {{on 'click' dr.closeHandler}}
      class={{ab.classes.defaultIconBtn}}
    >
      <AkIcon @iconName='close' />
    </AkIconButton>
  </AkAppbar>

  <AkStack
    @width='full'
    @direction='column'
    local-class='pii-details-drawer-content'
  >
    <AkStack @direction='column' @width='full' @spacing='1.5' class='py-2 px-3'>
      <AkTypography
        @color='textSecondary'
        data-test-privacyModule-pii-drawer-category-label
      >
        {{t 'privacyModule.piiCategory'}}
      </AkTypography>

      <AkTypography
        @fontWeight='medium'
        data-test-privacyModule-pii-drawer-category
      >
        {{this.selectedPii.type}}
      </AkTypography>
    </AkStack>

    <AkDivider />

    <AkStack @direction='column' @width='full' @spacing='2' class='py-2 px-3'>
      <AkStack @spacing='1' @alignItems='center'>
        <AkTypography
          @color='textSecondary'
          data-test-privacyModule-pii-drawer-data-found-label
        >
          {{t 'privacyModule.piiDataFound'}}
        </AkTypography>

        {{#if this.multiplePiiData}}
          <AkChip
            @label='{{this.multiplePiiDataLength}}'
            @size='small'
            @variant='semi-filled-outlined'
          />
        {{/if}}
      </AkStack>

      {{#if this.multiplePiiData}}
        <AkStack
          @width='full'
          @direction='column'
          local-class='pii-multiple-data'
        >
          {{#each this.selectedPii.piiData as |dataItem|}}
            <AkStack
              @width='full'
              @justifyContent='space-between'
              @alignItems='center'
              class='py-2 px-3'
            >
              <AkTypography
                @fontWeight='medium'
                @noWrap={{true}}
                data-test-privacyModule-pii-drawer-data-found
              >
                {{dataItem.value}}
              </AkTypography>

              <AkChip
                @label={{this.getSource dataItem.source}}
                @size='small'
                @color='primary'
                @variant='semi-filled'
              />
            </AkStack>

            {{!-- {{#if dataItem.urls}}
              <AkStack
                @width='full'
                @direction='column'
                @spacing='1'
                local-class='pii-details-api-urls-section'
                class='py-2 px-3'
              >

                <AkStack @spacing='1'>
                  <AkTypography
                    @fontWeight='bold'
                    {{style fontSize='0.857rem'}}
                  >
                    API URLâ€™s
                  </AkTypography>

                  <AkIcon @iconName='help' @size='small' />
                </AkStack>

                {{#each dataItem.urls as |url|}}
                  <AkStack @alignItems='center' @spacing='1'>
                    <AkTypography @underline='always'>{{url}}</AkTypography>

                    <AkClipboard
                      @onSuccess={{this.handleCopySuccess}}
                      @onError={{this.handleCopyError}}
                      as |ac|
                    >
                      <AkIconButton
                        data-clipboard-text={{url}}
                        id={{ac.triggerId}}
                        @size='small'
                      >
                        <AkIcon
                          @iconName='content-copy'
                          @size='small'
                          @color='textSecondary'
                        />
                      </AkIconButton>
                    </AkClipboard>
                  </AkStack>
                {{/each}}
              </AkStack>
            {{/if}} --}}

            <AkDivider />
          {{/each}}
        </AkStack>
      {{else}}
        <AkStack
          @width='full'
          @justifyContent='space-between'
          @alignItems='center'
        >
          <AkTypography
            @fontWeight='medium'
            @noWrap={{true}}
            data-test-privacyModule-pii-drawer-data-found
          >
            {{this.selectedPiiData.value}}
          </AkTypography>

          <AkChip
            @label={{this.getSource this.selectedPiiData.source}}
            @size='small'
            @color='primary'
            @variant='semi-filled'
          />
        </AkStack>
      {{/if}}
    </AkStack>
  </AkStack>
</AkDrawer>