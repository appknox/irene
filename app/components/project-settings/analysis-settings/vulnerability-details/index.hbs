<AkStack
  local-class='vulnerability-details-row vulnerability-details-row-height'
  class='pl-3 pr-4'
  @width='full'
  @justifyContent='space-between'
  @alignItems='center'
  data-test-vulnerability-details-container
>
  <AkStack data-test-vulnerability-details-name>
    {{! TODO: use AkIconButton }}
    {{! No AkIconButton due to design constraint, Design differs if i am using AkIconButton}}
    <AkIcon
      @iconName='arrow-drop-{{if this.isExpanded "up" "down"}}'
      class='pr-1'
      local-class='
      {{if this.selectedRiskKey "enable-expand-collapse-icon"}} 
      {{unless this.selectedRiskKey "disable-expand-collapse-icon"}}'
      {{on 'click' this.expandCollapse}}
      data-test-vulnerability-details-icon-click
    />
    {{this.vulnerabilityDetails.name}}
  </AkStack>

  {{#if (and this.riskOverridden (not this.isEditing))}}
    <div class='align-middle'>
      <RiskTag
        @label={{t (risk-text this.vulnerabilityRisk)}}
        @labelClass={{this.vulnerability.riskLabelClass}}
        data-test-vulnerability-risk-label-class
      />
    </div>
  {{else}}

    <AkSelect
      data-test-risk-select-preferences
      local-class='risk-select-width'
      @options={{this.risks}}
      @selected={{this.selectedRiskKey}}
      @onChange={{this.selectPreference}}
      @placeholder='Select Risk'
      as |aks|
    >
      {{t (risk-text aks.value)}}
    </AkSelect>
  {{/if}}
</AkStack>

{{#if this.isExpanded}}
  <AkStack @direction='column' @width='full' class='p-3' local-class='stack'>
    <AkTypography
      @variant='subtitle1'
      @color='textPrimary'
      @gutterBottom={{true}}
      data-test-vulnerability-risk-comments
    >
      {{t 'comments'}}
    </AkTypography>

    {{#if this.isEditing}}
      <Textarea
        data-test-vulnerability-comment-input
        aria-label='vulnerability comment'
        rows='1'
        placeholder={{t 'reasonForOverride'}}
        @value={{this.edittedComment}}
        local-class='comment-textarea'
      />

      <AkStack @alignItems='stretch'>
        <AkButton
          @disabled={{this.saveVulnerabilityPreferences.isRunning}}
          {{on 'click' this.savePreference}}
          data-test-vulnerability-save-button
        >
          {{t 'save'}}
        </AkButton>

        <AkButton
          class='ml-1'
          @variant='outlined'
          @color='neutral'
          {{on 'click' this.cancelEdit}}
          data-test-vulnerability-cancel-button
        >
          {{t 'cancel'}}
        </AkButton>
      </AkStack>

    {{else}}
      <AkStack @direction='column' @width='full'>
        <AkTypography
          @variant='body1'
          @color='textPrimary'
          @gutterBottom={{true}}
          data-test-vulnerability-comment
        >
          {{#if this.vulnerability.comment}}
            {{this.vulnerability.comment}}
          {{else}}
            {{t 'none'}}
          {{/if}}
        </AkTypography>

        <AkStack @alignItems='stretch' class='mt-1'>
          <AkButton
            @variant='outlined'
            {{on 'click' this.editPreference}}
            data-test-vulnerability-edit-button
          >
            {{t 'edit'}}
          </AkButton>

          <AkButton
            class='ml-1'
            {{on 'click' this.resetPreference}}
            data-test-vulnerability-reset-button
          >
            {{t 'reset'}}
          </AkButton>
        </AkStack>
      </AkStack>
    {{/if}}
  </AkStack>
{{/if}}