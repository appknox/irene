<AkStack
  local-class='stack summary-height'
  class='pl-3 pr-4'
  @width='full'
  @justifyContent='space-between'
  @alignItems='center'
>
  <AkStack>
    <AkIcon
      @iconName='arrow-drop-{{if this.isExpanded "up" "down"}}'
      class='pr-1'
      local-class='cursor-pointer'
      {{on 'click' this.expandCollapse}}
    />
    {{this.vulnerabilityDetails.name}}
  </AkStack>

  {{#if (and this.riskOverridden (not this.isEditing))}}
    <div local-class='select-width' class='align-middle'>
      <RiskTag
        local-class='risk-tag-width'
        @label={{t (risk-text this.vulnerabilityRisk)}}
        @labelClass={{this.vulnerability.riskLabelClass}}
      />
    </div>
  {{else}}
    <AkSelect
      local-class='select-width'
      @options={{this.risks}}
      @selected={{this.selectedRiskKey}}
      @onChange={{this.selectPreference}}
      @placeholder='Select Risk'
      as |aks|
    >
      {{t (risk-text aks.value)}}
    </AkSelect>
  {{/if}}
</AkStack>

{{#if this.isExpanded}}
  <AkStack @direction='column' @width='full' class='p-3' local-class='stack'>
    <AkTypography
      @variant='subtitle1'
      @color='textPrimary'
      @gutterBottom={{true}}
    >
      {{t 'comments'}}
    </AkTypography>

    {{#if this.isEditing}}
      <Textarea
        aria-label='vulnerability comment'
        rows='1'
        placeholder={{t 'reasonForOverride'}}
        @value={{this.edittedComment}}
        local-class='comment-textarea'
      />

      <AkStack @alignitems='center'>
        <AkButton
          @disabled={{this.saveVulnerabilityPreferences.isRunning}}
          {{on 'click' this.savePreference}}
        >
          {{t 'save'}}
        </AkButton>

        <AkButton
          class='ml-1'
          @variant='outlined'
          @color='neutral'
          {{on 'click' this.cancelEdit}}
        >
          {{t 'cancel'}}
        </AkButton>
      </AkStack>

    {{else}}
      <AkStack @direction='column' @width='full'>
        <AkTypography
          @variant='body1'
          @color='textPrimary'
          @gutterBottom={{true}}
        >
          {{#if this.vulnerability.comment}}
            {{this.vulnerability.comment}}
          {{else}}
            {{t 'none'}}
          {{/if}}
        </AkTypography>

        <AkStack @alignitems='center' class='mt-1'>
          <AkButton @variant='outlined' {{on 'click' this.editPreference}}>
            {{t 'edit'}}
          </AkButton>

          <AkButton class='ml-1' {{on 'click' this.resetPreference}}>
            {{t 'reset'}}
          </AkButton>
        </AkStack>
      </AkStack>
    {{/if}}
  </AkStack>
{{/if}}