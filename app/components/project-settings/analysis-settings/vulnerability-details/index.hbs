<AkStack
  local-class='vulnerability-details-container'
  class='pl-3 pr-4'
  @width='full'
  @justifyContent='space-between'
  @alignItems='center'
  data-prjSettings-analysisSettings-vulnDetails-container
>
  <AkStack
    @spacing='2'
    @alignItems='center'
    data-prjSettings-analysisSettings-vulnDetails-name
  >
    <AkIconButton
      disabled={{unless this.selectedRiskKey true false}}
      {{on 'click' this.expandCollapse}}
    >
      <AkIcon
        @iconName='arrow-drop-{{if this.isExpanded "up" "down"}}'
        data-prjSettings-analysisSettings-vulnDetails-expandViewIcon
      />
    </AkIconButton>

    {{this.vulnerabilityDetails.name}}
  </AkStack>

  {{#if (and this.riskOverridden (not this.isEditing))}}
    <RiskTag
      @label={{t (risk-text this.vulnerabilityRisk)}}
      @labelClass={{this.vulnerability.riskLabelClass}}
      data-prjSettings-analysisSettings-vulnDetails-riskLabelClass
    />

  {{else}}
    <AkSelect
      @options={{this.risks}}
      @selected={{this.selectedRiskKey}}
      @onChange={{this.selectPreference}}
      @placeholder='{{t "selectRisk"}}'
      {{style width='114px'}}
      data-prjSettings-analysisSettings-vulnDetails-riskSelectBox
      as |aks|
    >
      {{t (risk-text aks.value)}}
    </AkSelect>
  {{/if}}
</AkStack>

{{#if this.isExpanded}}
  <AkStack
    local-class='edit-details-container'
    @direction='column'
    @width='full'
    class='p-3'
  >
    <AkTypography
      @variant='subtitle1'
      @color='textPrimary'
      @gutterBottom={{true}}
      data-prjSettings-analysisSettings-vulnDetails-riskEditCommentDesc
    >
      {{t 'comments'}}
    </AkTypography>

    {{#if this.isEditing}}
      <Textarea
        data-prjSettings-analysisSettings-vulnDetails-commentInput
        aria-label='vulnerability comment'
        rows='1'
        placeholder={{t 'reasonForOverride'}}
        @value={{this.editedComment}}
        local-class='comment-textarea'
      />

      <AkStack @alignItems='stretch'>
        <AkButton
          @disabled={{this.saveVulnerabilityPreferences.isRunning}}
          {{on 'click' this.savePreference}}
          data-prjSettings-analysisSettings-vulnDetails-editSaveBtn
        >
          {{t 'save'}}
        </AkButton>

        <AkButton
          class='ml-1'
          @variant='outlined'
          @color='neutral'
          {{on 'click' this.cancelEdit}}
          data-prjSettings-analysisSettings-vulnDetails-editCancelBtn
        >
          {{t 'cancel'}}
        </AkButton>
      </AkStack>

    {{else}}
      <AkStack @direction='column' @width='full'>
        <AkTypography
          @variant='body1'
          @color='textPrimary'
          @gutterBottom={{true}}
          data-prjSettings-analysisSettings-vulnDetails-riskEditedComment
        >
          {{#if this.vulnerability.comment}}
            {{this.vulnerability.comment}}
          {{else}}
            {{t 'none'}}
          {{/if}}
        </AkTypography>

        <AkStack @alignItems='stretch' class='mt-1'>
          <AkButton
            @variant='outlined'
            {{on 'click' this.editPreference}}
            data-prjSettings-analysisSettings-vulnDetails-editBtn
          >
            {{t 'edit'}}
          </AkButton>

          <AkStack @alignItems='center' @spacing='1'>
            <AkButton
              @disabled={{this.saveVulnerabilityPreferences.isRunning}}
              class='ml-1'
              {{on 'click' this.resetPreference}}
              data-prjSettings-analysisSettings-vulnDetails-resetBtn
            >
              {{t 'reset'}}
            </AkButton>

            {{#if this.saveVulnerabilityPreferences.isRunning}}
              <AkLoader @size={{18}} />
            {{/if}}
          </AkStack>
        </AkStack>
      </AkStack>
    {{/if}}
  </AkStack>
{{/if}}